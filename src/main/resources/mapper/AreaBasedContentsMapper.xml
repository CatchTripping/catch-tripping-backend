<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bho.catchtrippingbackend.attractions.dao.AreaBasedContentsDao">

    <!-- ID로 데이터 조회 -->
    <select id="findById" parameterType="int" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents WHERE contentid = #{contentId}
    </select>

    <!-- 모든 데이터 조회 -->
    <select id="findAll" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents
    </select>

    <!-- 페이징된 데이터 조회 -->
    <select id="findAllWithPagination" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents
                          LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- 총 데이터 개수 조회 -->
    <select id="countAll" resultType="int">
        SELECT COUNT(*) FROM area_based_contents
    </select>

    <!-- 특정 지역 코드로 조회 -->
    <select id="findByAreaCode" parameterType="int" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents WHERE areacode = #{areaCode}
    </select>

    <!-- 특정 시군구 코드로 조회 -->
    <select id="findBySigunguCode" parameterType="int" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents WHERE sigungucode = #{sigunguCode}
    </select>

    <!-- 지역 코드와 시군구 코드로 조회 -->
    <select id="findByAreaCodeAndSigunguCode" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents
        WHERE areacode = #{areaCode} AND sigungucode = #{sigunguCode}
    </select>

    <!-- 카테고리로 조회 (cat1, cat2, cat3 조합) -->
    <select id="findByCategories" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents
        <where>
            <if test="cat1 != null">
                AND cat1 = #{cat1}
            </if>
            <if test="cat2 != null">
                AND cat2 = #{cat2}
            </if>
            <if test="cat3 != null">
                AND cat3 = #{cat3}
            </if>
        </where>
    </select>

    <!-- 타이틀을 포함하는 데이터를 조회 (검색어 기반) -->
    <select id="findByTitleContaining" parameterType="string" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents WHERE title LIKE CONCAT('%', #{title}, '%')
    </select>

    <!-- 좌표 범위로 조회 (지도의 특정 구역 내 검색) -->
    <select id="findByMapCoordinates" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents
        WHERE mapx BETWEEN #{minX} AND #{maxX}
          AND mapy BETWEEN #{minY} AND #{maxY}
    </select>

    <!-- 생성일 범위로 조회 -->
    <select id="findByCreatedTimeBetween" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents
        WHERE createdtime BETWEEN #{start} AND #{end}
    </select>

    <!-- 수정일 범위로 조회 -->
    <select id="findByModifiedTimeBetween" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents
        WHERE modifiedtime BETWEEN #{start} AND #{end}
    </select>

    <!-- 복합 검색 메서드 -->
    <select id="searchAttractions" parameterType="com.bho.catchtrippingbackend.attractions.dto.AttractionSearchCriteria" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents
        <where>
            <if test="areaCode != null">
                AND areacode = #{areaCode}
            </if>
            <if test="sigunguCode != null">
                AND sigungucode = #{sigunguCode}
            </if>
            <if test="cat1 != null">
                AND cat1 = #{cat1}
            </if>
            <if test="cat2 != null">
                AND cat2 = #{cat2}
            </if>
            <if test="cat3 != null">
                AND cat3 = #{cat3}
            </if>
            <if test="titleKeyword != null">
                AND title LIKE CONCAT('%', #{titleKeyword}, '%')
            </if>
            <if test="minX != null and maxX != null and minY != null and maxY != null">
                AND mapx BETWEEN #{minX} AND #{maxX}
                AND mapy BETWEEN #{minY} AND #{maxY}
            </if>
            <if test="createdTimeStart != null and createdTimeEnd != null">
                AND createdtime BETWEEN #{createdTimeStart} AND #{createdTimeEnd}
            </if>
            <if test="modifiedTimeStart != null and modifiedTimeEnd != null">
                AND modifiedtime BETWEEN #{modifiedTimeStart} AND #{modifiedTimeEnd}
            </if>
        </where>
    </select>

    <!-- 복합 검색 결과의 총 개수 조회 -->
    <select id="countSearchAttractions" parameterType="com.bho.catchtrippingbackend.attractions.dto.AttractionSearchCriteria" resultType="int">
        SELECT COUNT(*) FROM area_based_contents
        <where>
            <if test="areaCode != null">
                AND areacode = #{areaCode}
            </if>
            <if test="sigunguCode != null">
                AND sigungucode = #{sigunguCode}
            </if>
            <if test="cat1 != null">
                AND cat1 = #{cat1}
            </if>
            <if test="cat2 != null">
                AND cat2 = #{cat2}
            </if>
            <if test="cat3 != null">
                AND cat3 = #{cat3}
            </if>
            <if test="titleKeyword != null">
                AND title LIKE CONCAT('%', #{titleKeyword}, '%')
            </if>
            <if test="minX != null and maxX != null and minY != null and maxY != null">
                AND mapx BETWEEN #{minX} AND #{maxX}
                AND mapy BETWEEN #{minY} AND #{maxY}
            </if>
            <if test="createdTimeStart != null and createdTimeEnd != null">
                AND createdtime BETWEEN #{createdTimeStart} AND #{createdTimeEnd}
            </if>
            <if test="modifiedTimeStart != null and modifiedTimeEnd != null">
                AND modifiedtime BETWEEN #{modifiedTimeStart} AND #{modifiedTimeEnd}
            </if>
        </where>
    </select>

    <!-- 복합 검색의 페이징된 데이터 조회 -->
    <select id="searchAttractionsWithPagination" parameterType="map" resultType="com.bho.catchtrippingbackend.attractions.dto.AreaBasedContents">
        SELECT * FROM area_based_contents
        <where>
            <if test="criteria.areaCode != null">
                AND areacode = #{criteria.areaCode}
            </if>
            <if test="criteria.sigunguCode != null">
                AND sigungucode = #{criteria.sigunguCode}
            </if>
            <if test="criteria.cat1 != null">
                AND cat1 = #{criteria.cat1}
            </if>
            <if test="criteria.cat2 != null">
                AND cat2 = #{criteria.cat2}
            </if>
            <if test="criteria.cat3 != null">
                AND cat3 = #{criteria.cat3}
            </if>
            <if test="criteria.titleKeyword != null">
                AND title LIKE CONCAT('%', #{criteria.titleKeyword}, '%')
            </if>
            <if test="criteria.minX != null and criteria.maxX != null and criteria.minY != null and criteria.maxY != null">
                AND mapx BETWEEN #{criteria.minX} AND #{criteria.maxX}
                AND mapy BETWEEN #{criteria.minY} AND #{criteria.maxY}
            </if>
            <if test="criteria.createdTimeStart != null and criteria.createdTimeEnd != null">
                AND createdtime BETWEEN #{criteria.createdTimeStart} AND #{criteria.createdTimeEnd}
            </if>
            <if test="criteria.modifiedTimeStart != null and criteria.modifiedTimeEnd != null">
                AND modifiedtime BETWEEN #{criteria.modifiedTimeStart} AND #{criteria.modifiedTimeEnd}
            </if>
        </where>
        LIMIT #{limit} OFFSET #{offset}
    </select>

</mapper>
